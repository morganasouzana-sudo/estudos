<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Estudos SEBRAE 2026 - Completo</title>
    <style>
        :root { --primary: #005DAA; --primary-dark: #004580; --secondary: #FFD200; --text: #333; --bg: #f4f7f6; --success: #28a745; --error: #dc3545; }
        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Segoe UI', sans-serif; }
        body { background: var(--bg); color: var(--text); padding: 20px; display: flex; justify-content: center; }
        .container { width: 100%; max-width: 900px; background: white; border-radius: 12px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); overflow: hidden; display: flex; flex-direction: column; min-height: 80vh; }
        
        /* Header */
        header { background: var(--primary); color: white; padding: 15px 20px; display: flex; justify-content: space-between; align-items: center; }
        .header-controls button { background: rgba(255,255,255,0.2); border: none; color: white; padding: 5px 10px; border-radius: 4px; cursor: pointer; font-size: 0.8rem; margin-left: 5px; }
        .header-controls button:hover { background: rgba(255,255,255,0.3); }

        /* Screens */
        .screen { display: none; padding: 20px; flex: 1; flex-direction: column; }
        .screen.active { display: flex; }

        /* Home */
        .stats-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin-bottom: 20px; }
        .stat-box { background: #f8f9fa; padding: 15px; border-radius: 8px; text-align: center; border: 1px solid #eee; }
        .stat-num { font-size: 1.5rem; font-weight: bold; color: var(--primary); }
        .stat-label { font-size: 0.85rem; color: #666; }

        .control-panel { background: #f0f4f8; padding: 20px; border-radius: 8px; margin-bottom: 20px; }
        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; margin-bottom: 5px; font-weight: 600; font-size: 0.9rem; }
        select, button { width: 100%; padding: 10px; border-radius: 6px; border: 1px solid #ccc; font-size: 1rem; }
        button.primary { background: var(--primary); color: white; border: none; font-weight: bold; cursor: pointer; transition: 0.2s; }
        button.primary:hover { background: var(--primary-dark); }
        
        /* Quiz */
        .progress-bar { height: 8px; background: #eee; border-radius: 4px; margin-bottom: 20px; overflow: hidden; }
        .progress-fill { height: 100%; background: var(--success); width: 0%; transition: 0.3s; }
        .q-meta { display: flex; justify-content: space-between; color: #666; font-size: 0.9rem; margin-bottom: 10px; }
        .q-text { font-size: 1.2rem; margin-bottom: 20px; line-height: 1.5; }
        .options { display: flex; flex-direction: column; gap: 10px; }
        .opt-btn { background: white; border: 1px solid #ddd; padding: 15px; text-align: left; border-radius: 8px; cursor: pointer; transition: 0.2s; }
        .opt-btn:hover { background: #f9f9f9; border-color: #bbb; }
        .opt-btn.correct { background: #d4edda; border-color: var(--success); color: #155724; }
        .opt-btn.wrong { background: #f8d7da; border-color: var(--error); color: #721c24; }
        
        .feedback { margin-top: 20px; padding: 15px; background: #eef6fc; border-left: 4px solid var(--primary); display: none; }
        .feedback h4 { color: var(--primary); margin-bottom: 5px; }

        /* Flashcards */
        .fc-container { flex: 1; display: flex; justify-content: center; align-items: center; perspective: 1000px; margin: 20px 0; }
        .flashcard { width: 100%; height: 300px; position: relative; transform-style: preserve-3d; transition: transform 0.6s; cursor: pointer; }
        .flashcard.flipped { transform: rotateY(180deg); }
        .fc-face { position: absolute; width: 100%; height: 100%; backface-visibility: hidden; display: flex; flex-direction: column; justify-content: center; align-items: center; text-align: center; padding: 20px; background: white; border: 1px solid #ddd; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); }
        .fc-front { font-size: 1.3rem; font-weight: bold; color: var(--primary); }
        .fc-back { transform: rotateY(180deg); background: var(--primary); color: white; font-size: 1.1rem; }
        
        /* Footer */
        .footer { margin-top: auto; display: flex; gap: 10px; justify-content: flex-end; }
        button.secondary { background: white; color: #666; border: 1px solid #ccc; cursor: pointer; }

    </style>
</head>
<body>

<div class="container">
    <header>
        <div>SEBRAE 2026 <span style="font-size:0.8rem; opacity:0.8">Analista Projetos</span></div>
        <div class="header-controls">
            <button onclick="app.downloadJSON()">⬇ Baixar Dados (JSON)</button>
        </div>
    </header>

    <!-- HOME -->
    <div id="screen-home" class="screen active">
        <div class="stats-grid">
            <div class="stat-box"><div class="stat-num" id="st-total">0</div><div class="stat-label">Respondidas</div></div>
            <div class="stat-box"><div class="stat-num" id="st-acc">0%</div><div class="stat-label">Precisão</div></div>
            <div class="stat-box"><div class="stat-num" id="st-db">220</div><div class="stat-label">Questões Totais</div></div>
        </div>

        <div class="control-panel">
            <div class="form-group">
                <label>Modo de Estudo</label>
                <select id="sel-mode">
                    <option value="quiz">Quiz (Questões)</option>
                    <option value="flashcard">Flashcards (Revisão)</option>
                </select>
            </div>
            
            <div class="form-group">
                <label>Disciplina / Tema</label>
                <select id="sel-subject">
                    <option value="all">Todas as Disciplinas</option>
                    <!-- Preenchido via JS -->
                </select>
            </div>

            <button class="primary" onclick="app.start()">INICIAR SESSÃO</button>
        </div>
        
        <div style="text-align: center; margin-top: 20px; font-size: 0.8rem; color: #999;">
            Base de dados consolidada: Partes 1 a 7 (IN 07, IN 36, IN 41, IN 51, Licitações, Projetos, Agro)
        </div>
    </div>

    <!-- QUIZ -->
    <div id="screen-quiz" class="screen">
        <div class="progress-bar"><div class="progress-fill" id="qz-bar"></div></div>
        <div class="q-meta"><span id="qz-subj">Tema</span><span id="qz-count">1/10</span></div>
        <div class="q-text" id="qz-text">...</div>
        <div class="options" id="qz-opts"></div>
        <div class="feedback" id="qz-feed">
            <h4 id="qz-feed-title">Explicação</h4>
            <p id="qz-feed-text">...</p>
        </div>
        <div class="footer">
            <button class="secondary" onclick="app.home()">Sair</button>
            <button class="primary" id="qz-next" onclick="app.nextQ()" style="display:none">Próxima</button>
        </div>
    </div>

    <!-- FLASHCARD -->
    <div id="screen-fc" class="screen">
        <div class="q-meta" style="justify-content:center"><span id="fc-count">1/10</span></div>
        <div class="fc-container">
            <div class="flashcard" onclick="this.classList.toggle('flipped')">
                <div class="fc-face fc-front"><span id="fc-front">...</span><div style="margin-top:20px; font-size:0.8rem; opacity:0.6">(Clique para virar)</div></div>
                <div class="fc-face fc-back"><span id="fc-back">...</span></div>
            </div>
        </div>
        <div class="footer" style="justify-content: space-between;">
            <button class="secondary" onclick="app.home()">Encerrar</button>
            <button class="primary" onclick="app.nextFc()">Próximo Card ➡</button>
        </div>
    </div>
</div>

<script>
// --- BANCO DE DADOS COMPLETO (MINIFICADO PARA CABER AQUI) ---
const DB = {
  "questoes": [
    // PARTE 1 - GERAL / PROJETOS / AGRO
    {"id":1,"tema":"Gestão de Projetos","enunciado":"No PMI, o documento que autoriza formalmente o projeto é:","alternativas":["EAP","Termo de Abertura (Project Charter)","Plano de Gerenciamento","Escopo"],"correta":1,"explicacao":"O Termo de Abertura (TAP) oficializa o projeto."},
    {"id":2,"tema":"Agro - Certificações","enunciado":"O GlobalGap foca principalmente em:","alternativas":["Qualidade visual","Orgânicos exclusivos","Boas Práticas Agrícolas (BPA) e segurança","Certificação religiosa"],"correta":2,"explicacao":"GlobalGap é referência em BPA e segurança alimentar."},
    {"id":3,"tema":"Agro - Certificações","enunciado":"A Rainforest Alliance foca em:","alternativas":["Custos","Transgênicos","Sustentabilidade e biodiversidade","Processamento"],"correta":2,"explicacao":"Foca em sustentabilidade ambiental e social (o selo do sapo)."},
    {"id":4,"tema":"ESG","enunciado":"Ação do pilar 'S' (Social) no Sebrae:","alternativas":["Compliance","Energia solar","Empreendedorismo feminino","Digitalização"],"correta":2,"explicacao":"Pilar Social envolve pessoas e inclusão."},
    {"id":5,"tema":"Gestão de Projetos","enunciado":"Função da EAP (WBS):","alternativas":["Cronograma","Decompor escopo hierarquicamente","Riscos","Custo"],"correta":1,"explicacao":"EAP decompõe as entregas do projeto."},
    {"id":6,"tema":"Produtos Sebrae","enunciado":"O Sebraetec visa:","alternativas":["Empréstimo","Subsídio para inovação/tecnologia","Feiras","Mão de obra"],"correta":1,"explicacao":"Subsidiada consultoria tecnológica."},
    {"id":7,"tema":"Legislação","enunciado":"LGPD no Sebrae:","alternativas":["Isento","Dados livres","Respeito à finalidade e necessidade","Apenas PJ"],"correta":2,"explicacao":"Aplica-se a todos, exigindo base legal e finalidade."},
    {"id":9,"tema":"Qualidade","enunciado":"Ciclo PDCA significa:","alternativas":["Plan, Do, Check, Act","Process, Design, Calc, Analise","Outros","Outros"],"correta":0,"explicacao":"Planejar, Executar, Verificar, Agir."},
    {"id":10,"tema":"Agro - Certificações","enunciado":"Orgânicos no Brasil exigem:","alternativas":["Pouco veneno","Rastreabilidade e sem transgênicos","Autodeclaração simples","Cor verde"],"correta":1,"explicacao":"Proibido transgênicos e agrotóxicos sintéticos."},
    {"id":11,"tema":"Gestão de Projetos","enunciado":"Mitigar um risco é:","alternativas":["Eliminar","Transferir","Reduzir probabilidade/impacto","Aceitar"],"correta":2,"explicacao":"Mitigar = Reduzir."},
    {"id":12,"tema":"Conhecimentos Sebrae","enunciado":"Natureza jurídica do Sebrae:","alternativas":["Empresa Pública","Autarquia","Serviço Social Autônomo (Privado)","Economia Mista"],"correta":2,"explicacao":"Sistema S, direito privado, sem fins lucrativos."},
    {"id":13,"tema":"Gestão de Projetos","enunciado":"Caminho Crítico é:","alternativas":["Mais curto","Sequência sem folga (mais longo)","Menos importante","Mais barato"],"correta":1,"explicacao":"Determina a duração do projeto."},
    {"id":14,"tema":"Gestão de Projetos","enunciado":"Matriz RACI define:","alternativas":["ROI","Papéis e responsabilidades","Riscos","Layout"],"correta":1,"explicacao":"Responsible, Accountable, Consulted, Informed."},
    
    // PARTE 2 - LICITAÇÕES (RES 493)
    {"id":41,"tema":"Licitações (Res 493)","enunciado":"O Sebrae tem regulamento próprio de licitações porque é:","alternativas":["Empresa Pública","Estatal","Serviço Social Autônomo","Autarquia"],"correta":2,"explicacao":"Entidade privada de cooperação."},
    {"id":42,"tema":"Licitações (Res 493)","enunciado":"NÃO é modalidade do Sebrae:","alternativas":["Tomada de Preços","Diálogo Competitivo","Desafio Inovação","Convite"],"correta":0,"explicacao":"Tomada de Preços foi extinta no regulamento novo."},
    {"id":43,"tema":"Licitações (Res 493)","enunciado":"Limite Convite Obras/Engenharia:","alternativas":["166k","826k","R$ 2.465.000,00","395k"],"correta":2,"explicacao":"Teto para convite de obras."},
    {"id":44,"tema":"Licitações (Res 493)","enunciado":"Dispensa Obras/Engenharia valor:","alternativas":["50k","92k","R$ 166.000,00","330k"],"correta":2,"explicacao":"Dispensa por valor para obras."},
    {"id":45,"tema":"Licitações (Res 493)","enunciado":"Artista consagrado contrata-se por:","alternativas":["Dispensa","Inexigibilidade","Credenciamento","Pré-qualificação"],"correta":1,"explicacao":"Inviabilidade de competição."},
    {"id":46,"tema":"Licitações (Res 493)","enunciado":"Aditivo de valor limite:","alternativas":["25%","50% do inicial atualizado","100%","Ilimitado"],"correta":1,"explicacao":"Sebrae permite aditivo de até 50% (diferente da lei geral)."},
    {"id":49,"tema":"Licitações (Res 493)","enunciado":"Vigência máxima Ata SRP:","alternativas":["12 meses","24 meses","36 meses","60 meses"],"correta":2,"explicacao":"Incluindo prorrogações."},
    {"id":50,"tema":"Licitações (Res 493)","enunciado":"Cota MPE bens divisíveis > 80k:","alternativas":["10%","25%","50%","100%"],"correta":1,"explicacao":"Cota de até 25%."},
    {"id":52,"tema":"Licitações (Res 493)","enunciado":"Critérios julgamento Pregão:","alternativas":["Técnica","Menor preço ou Maior desconto","Retorno","Conteúdo"],"correta":1,"explicacao":"Pregão é preço ou desconto."},
    {"id":55,"tema":"Licitações (Res 493)","enunciado":"Credenciamento é para:","alternativas":["Obras","Contratação paralela e não excludente","Exclusividade","Preço fixo"],"correta":1,"explicacao":"Vários fornecedores aptos simultâneos."},
    
    // PARTE 3 - CONVÊNIOS (MANUAL)
    {"id":81,"tema":"Convênios (Manual)","enunciado":"Instrumento de intenções sem repasse:","alternativas":["Técnico","Parceria","Cooperação Geral","Financeiro"],"correta":2,"explicacao":"Cooperação Geral (ou Memorando) é genérico."},
    {"id":82,"tema":"Convênios (Manual)","enunciado":"Tempo existência entidade privada:","alternativas":["1 ano","2 anos","3 anos","5 anos"],"correta":2,"explicacao":"Mínimo 3 anos de constituição."},
    {"id":83,"tema":"Convênios (Manual)","enunciado":"Prazo Termo de Parceria:","alternativas":["1 mês","3 meses","1 ano","Indefinido"],"correta":0,"explicacao":"Ações pontuais de até 1 mês."},
    {"id":84,"tema":"Convênios (Manual)","enunciado":"Contrapartida mínima parceiro:","alternativas":["5%","10%","15% (Financeira)","50%"],"correta":2,"explicacao":"Mínimo 15% financeiro."},
    {"id":85,"tema":"Convênios (Manual)","enunciado":"Despesas administrativas executor:","alternativas":["Vedadas","Limitadas a 15% do projeto","Sem limite","50%"],"correta":1,"explicacao":"Aceitas se previstas, até 15%."},
    {"id":86,"tema":"Convênios (Manual)","enunciado":"Desembolso de recursos:","alternativas":["Sebrae primeiro","Parceiro primeiro","Concomitante","Livre"],"correta":2,"explicacao":"Aportes devem ser proporcionais e simultâneos."},
    
    // PARTE 4 - IN 07 (FINANCEIRO)
    {"id":101,"tema":"IN 07/2019 - Financeiro","enunciado":"Prazo cadastro contrato após assinatura:","alternativas":["5 dias","Imediatamente","Antes","Mensal"],"correta":1,"explicacao":"Imediatamente após assinatura."},
    {"id":102,"tema":"IN 07/2019 - Financeiro","enunciado":"Saldo contrato na renovação:","alternativas":["Usa no aditivo","Transfere","Vedado uso (deve encerrar)","Livre"],"correta":2,"explicacao":"Não se usa saldo antigo em aditivo de renovação."},
    {"id":103,"tema":"IN 07/2019 - Financeiro","enunciado":"Retenção pagamento por irregularidade fiscal:","alternativas":["Sempre","Nunca","Só se for Cessão de Mão de Obra","Depende do valor"],"correta":2,"explicacao":"Regra geral paga e pune. Exceção: terceirização retém."},
    {"id":105,"tema":"IN 07/2019 - Financeiro","enunciado":"Datas pagamento folha Sebrae:","alternativas":["5 e 20","15 e 30","10 (30%) e 25 (saldo)","Livre"],"correta":2,"explicacao":"Adiantamento dia 10, saldo dia 25."},
    {"id":106,"tema":"IN 07/2019 - Financeiro","enunciado":"Liberação parcela convênio exige execução de:","alternativas":["50%","80% da etapa anterior","100%","30%"],"correta":1,"explicacao":"Regra dos 80% da parcela anterior."},
    {"id":107,"tema":"IN 07/2019 - Financeiro","enunciado":"Limite Fundo Fixo (Pequena monta):","alternativas":["100","300","500","1000"],"correta":2,"explicacao":"R$ 500,00."},
    {"id":109,"tema":"IN 07/2019 - Financeiro","enunciado":"Prazo UGF protocolar documento:","alternativas":["1 dia","2 dias","4 dias úteis","5 dias"],"correta":2,"explicacao":"4 dias úteis."},
    
    // PARTE 5 - IN 36 (CONTRATAÇÕES)
    {"id":141,"tema":"IN 36/2024 - Contratações","enunciado":"Documento que caracteriza o objeto (IN 36):","alternativas":["PB","ETP","Termo de Referência (TR)","Mapa"],"correta":2,"explicacao":"TR define o objeto."},
    {"id":142,"tema":"IN 36/2024 - Contratações","enunciado":"Garantia contratual obrigatória em:","alternativas":["Bens","Mão de obra terceirizada","Consultoria","Sempre"],"correta":1,"explicacao":"Risco trabalhista exige garantia."},
    {"id":144,"tema":"IN 36/2024 - Contratações","enunciado":"Validade pesquisa de preços:","alternativas":["60 dias","90 dias","180 dias","1 ano"],"correta":2,"explicacao":"6 meses (180 dias)."},
    {"id":146,"tema":"IN 36/2024 - Contratações","enunciado":"Regularidade fiscal dispensa valor:","alternativas":["FGTS só","Todas","Dispensada até R$ 92k","Federal só"],"correta":2,"explicacao":"Até 92k dispensa doc fiscal."},
    {"id":147,"tema":"IN 36/2024 - Contratações","enunciado":"Regularidade fiscal 92k a 826k:","alternativas":["Todas","Federal e FGTS","Estadual","Nenhuma"],"correta":1,"explicacao":"Faixa intermediária pede Federal+FGTS."},
    {"id":153,"tema":"IN 36/2024 - Contratações","enunciado":"Apostilamento serve para:","alternativas":["Alterar objeto","Novo contrato","Reajuste/Erro material (sem assinatura da contratada)","Prorrogar valor"],"correta":2,"explicacao":"Ajustes simples sem mudar essência."},
    
    // PARTE 6 - IN 51 (GESTÃO CONTRATOS)
    {"id":171,"tema":"IN 51/2025 - Gestão Contratos","enunciado":"Quem indica o gestor do contrato?","alternativas":["DAF","UAC","Gerente da unidade demandante","RH"],"correta":2,"explicacao":"Gerente da área dona da demanda."},
    {"id":172,"tema":"IN 51/2025 - Gestão Contratos","enunciado":"Gestor Adm e Técnico podem ser o mesmo?","alternativas":["Nunca","Sim, dependendo da complexidade","Sempre","Só se for gerente"],"correta":1,"explicacao":"Permitido se não for complexo."},
    {"id":179,"tema":"IN 51/2025 - Gestão Contratos","enunciado":"Glosa é:","alternativas":["Bônus","Retenção por falha na execução","Multa","Juros"],"correta":1,"explicacao":"Desconto por serviço não prestado."},
    {"id":176,"tema":"IN 51/2025 - Gestão Contratos","enunciado":"Quem aplica penalidade?","alternativas":["Gestor","Gerente","Autoridade signatária do contrato","Auditor"],"correta":2,"explicacao":"Quem assinou o contrato pune."},
    
    // PARTE 7 - IN 41 (PROJETOS/PARCERIAS)
    {"id":201,"tema":"IN 41/2025 - Projetos","enunciado":"Portal de Convênios é:","alternativas":["Notícias","Sistema de gestão de parcerias","Transparência","ERP"],"correta":1,"explicacao":"Ferramenta oficial de gestão."},
    {"id":202,"tema":"IN 41/2025 - Projetos","enunciado":"Recursos de terceiros (Sebrae executor), regras:","alternativas":["Do Sebrae","Da concedente","Lei 8666","Nenhuma"],"correta":1,"explicacao":"Quem dá o dinheiro define a regra."},
    {"id":209,"tema":"IN 41/2025 - Projetos","enunciado":"Contrapartida parceiro regra:","alternativas":["Econômica","Mín 15% Financeira","Livre","10%"],"correta":1,"explicacao":"15% cash."},
    {"id":210,"tema":"IN 41/2025 - Projetos","enunciado":"ATP é inserida no:","alternativas":["SEAP","SIAFI","Portal","Excel"],"correta":0,"explicacao":"Sistema de Acompanhamento de Projetos."}
  ],
  "flashcards": [
    {"frente":"Prazo Cadastro Contrato (IN 07)","verso":"Imediatamente"},
    {"frente":"Limite Aditivo Valor (Res 493)","verso":"50%"},
    {"frente":"Validade Pesquisa Preço (IN 36)","verso":"180 dias"},
    {"frente":"Contrapartida Mínima Convênio","verso":"15% Financeira"},
    {"frente":"Glosa","verso":"Retenção por serviço mal feito"},
    {"frente":"Gestor Técnico","verso":"Avalia qualidade/SLA"},
    {"frente":"Prazo Pagamento Padrão","verso":"30 dias após atesto"},
    {"frente":"Vigência Máxima Ata SRP","verso":"36 meses"},
    {"frente":"Cota MPE Licitação","verso":"25% (bens divisíveis > 80k)"},
    {"frente":"Limite Dispensa Obras (Res 493)","verso":"R$ 166.000,00"}
  ]
};
// --------------------------------------------------------

const app = {
    state: {
        mode: 'quiz',
        questions: [],
        currentIndex: 0,
        score: 0,
        answered: false
    },
    
    init() {
        // Carrega stats do localStorage
        this.updateStatsDisplay();
        this.populateSubjects();
        
        // Seletor de modo
        document.getElementById('sel-mode').addEventListener('change', (e) => {
            this.state.mode = e.target.value;
        });
    },
    
    populateSubjects() {
        const subjects = new Set();
        DB.questoes.forEach(q => subjects.add(q.tema));
        const sel = document.getElementById('sel-subject');
        Array.from(subjects).sort().forEach(s => {
            const opt = document.createElement('option');
            opt.value = s;
            opt.innerText = s;
            sel.appendChild(opt);
        });
    },

    start() {
        const mode = document.getElementById('sel-mode').value;
        const subj = document.getElementById('sel-subject').value;
        
        let data = mode === 'quiz' ? DB.questoes : DB.flashcards;
        
        // Filtro
        if(mode === 'quiz' && subj !== 'all') {
            data = data.filter(q => q.tema === subj);
        }
        
        // Embaralhar
        data = data.sort(() => Math.random() - 0.5);
        
        this.state.questions = data;
        this.state.currentIndex = 0;
        this.state.score = 0;
        this.state.mode = mode;
        this.state.answered = false;
        
        if(data.length === 0) { alert("Sem dados para este filtro."); return; }
        
        this.showScreen(mode === 'quiz' ? 'screen-quiz' : 'screen-fc');
        
        if(mode === 'quiz') this.renderQuiz();
        else this.renderFc();
    },

    renderQuiz() {
        const q = this.state.questions[this.state.currentIndex];
        const total = this.state.questions.length;
        
        document.getElementById('qz-subj').innerText = q.tema;
        document.getElementById('qz-count').innerText = `${this.state.currentIndex+1}/${total}`;
        document.getElementById('qz-text').innerText = q.enunciado;
        document.getElementById('qz-bar').style.width = `${((this.state.currentIndex)/total)*100}%`;
        
        const optsDiv = document.getElementById('qz-opts');
        optsDiv.innerHTML = '';
        document.getElementById('qz-feed').style.display = 'none';
        document.getElementById('qz-next').style.display = 'none';
        this.state.answered = false;

        q.alternativas.forEach((alt, idx) => {
            const btn = document.createElement('div');
            btn.className = 'opt-btn';
            btn.innerText = alt;
            btn.onclick = () => this.answer(idx, btn, q.correta, q.explicacao);
            optsDiv.appendChild(btn);
        });
    },

    answer(idx, btn, correctIdx, explanation) {
        if(this.state.answered) return;
        this.state.answered = true;
        
        const btns = document.querySelectorAll('.opt-btn');
        btns[correctIdx].classList.add('correct');
        
        if(idx === correctIdx) {
            this.state.score++;
        } else {
            btn.classList.add('wrong');
        }
        
        document.getElementById('qz-feed-text').innerText = explanation;
        document.getElementById('qz-feed').style.display = 'block';
        document.getElementById('qz-next').style.display = 'block';
    },

    nextQ() {
        this.state.currentIndex++;
        if(this.state.currentIndex < this.state.questions.length) {
            this.renderQuiz();
        } else {
            this.finish();
        }
    },

    renderFc() {
        const fc = this.state.questions[this.state.currentIndex];
        document.getElementById('fc-count').innerText = `${this.state.currentIndex+1}/${this.state.questions.length}`;
        document.getElementById('fc-front').innerText = fc.frente;
        document.getElementById('fc-back').innerText = fc.verso;
        document.querySelector('.flashcard').classList.remove('flipped');
    },

    nextFc() {
        this.state.currentIndex++;
        if(this.state.currentIndex < this.state.questions.length) {
            this.renderFc();
        } else {
            alert("Fim dos cards!");
            this.home();
        }
    },

    finish() {
        const total = this.state.questions.length;
        const score = this.state.score;
        alert(`Fim! Você acertou ${score} de ${total}.`);
        
        // Salvar stats
        const current = JSON.parse(localStorage.getItem('sebrae_stats') || '{"total":0, "acc":0}');
        current.total += total;
        // Simplificação de accuracy global
        current.acc = Math.round((score/total)*100); 
        localStorage.setItem('sebrae_stats', JSON.stringify(current));
        
        this.home();
    },

    home() {
        this.updateStatsDisplay();
        this.showScreen('screen-home');
    },

    updateStatsDisplay() {
        const stats = JSON.parse(localStorage.getItem('sebrae_stats') || '{"total":0, "acc":0}');
        document.getElementById('st-total').innerText = stats.total;
        document.getElementById('st-acc').innerText = stats.acc + '%';
        document.getElementById('st-db').innerText = DB.questoes.length;
    },

    showScreen(id) {
        document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
        document.getElementById(id).classList.add('active');
    },

    downloadJSON() {
        const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(DB, null, 2));
        const downloadAnchorNode = document.createElement('a');
        downloadAnchorNode.setAttribute("href", dataStr);
        downloadAnchorNode.setAttribute("download", "sebrae_simulado_completo.json");
        document.body.appendChild(downloadAnchorNode);
        downloadAnchorNode.click();
        downloadAnchorNode.remove();
    }
};

app.init();
</script>
</body>
</html>
